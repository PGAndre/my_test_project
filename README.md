# Описание

В проекте я использовал паттерн Репозиторий для абстрагирования уровня логики 
от уровня доступа к данным (БД, API dadata), совместно с использованием Доменной 
модели Users (немножко DDD). 
Использовал так же кастомные классы для работы с redis и репозиторием. В рабочем проекте
их можно выделить в отдельные библиотеки и добавить логирование (например в graylog).
В тестах постарался показать основные принципы (тестирование API, тестирование схемы данных,
использование mockов и фикстур). В рабочем проекте тестов должно быть сильно больше)).
Отдельно стоит написать тесты для тестирования методов репозитория(на тестовой базе в 
транзакциях для отката изменений после каждого теста). Но сейчас частично эти методы
задействованы в тестах ручек. Для проверки работы redis есть две ручки, через которые
можно посмотреть закешированные ключи и сбросить кэш.

## Настройка окружения
для запуска приложения в docker запустите в корне проекта
```shell
docker-compose up -d
```
Для входа в Swagger: http://localhost:7002/docs
## Структура проекта


- ...

## Работа с проектом

### cli

```sh
Usage: cli.py [OPTIONS] COMMAND [ARGS]...

Commands:
  api
  migrate
  rollback
```

#### Пример

```sh
python cli.py api --host 0.0.0.0 --port 5000
```

### app


- Миграции

  ```sh
  alembic revision --autogenerate -m "migration_comment"
  alembic upgrade head
  ```

### tests

#### Запуск тестов
для корректного запуска проекта и запуска тестов локально я не стал добавлять .env файл в
gitignore. В рабочем прокте так делать нельзя - переменные надо подставлять через CI\CD envs.

запустить:
```sh
pytest -x -rfE --tb=short tests/
```

#### Покрытие тестов

```sh
pytest -x -rfE --tb=short --cov=app tests/
```


- Запуск линтеров

  ```sh
  ./scripts/lint.sh
  ```

- Автоформатирование

  ```sh
  ./scripts/format.sh
  ```

# Задача 2

```sql

SELECT
  t1.Телефон,
  t2.Фамилия || ' ' || t2.Имя || ' ' || t2.Отчество AS ФИО,
  t2.Адрес_места_жительства_страна || ', ' || t2.Адрес_места_жительства_город || ', ' || t1.Улица || ', ' || t1.Дом || ', ' || t1.Квартира AS Адрес
FROM
  table1 t1
    JOIN
  table2 t2 ON (t1.ФИО = t2.Фамилия || ' ' || t2.Имя || ' ' || t2.Отчество)
    AND (t1.Улица = t2.Адрес_места_жительства_улица)
    AND (t1.Дом = t2.Адрес_места_жительства_дом)
    AND (t1.Квартира = t2.Адрес_места_жительства_квартира);
```